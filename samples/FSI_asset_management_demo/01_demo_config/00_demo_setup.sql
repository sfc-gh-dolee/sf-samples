/*
LP Data Upload:
Initially, ensure to upload the six files named LP_data, along with referential_lps and lps_investments, into your external stage. These files comprise critical information regarding Limited Partners (LPs), detailing engagements, distributions, and investments, along with referential data. Adjust the COPY INTO command to match your S3 bucket's nomenclature for importing this data into Snowflake.*/
CREATE OR REPLACE DATABASE SNOW_INVEST; 
CREATE OR REPLACE SCHEMA BRONZE;
CREATE OR REPLACE STAGE EXTERNAL_STAGE;
CREATE OR REPLACE SCHEMA SILVER;
CREATE OR REPLACE SCHEMA GOLD;

CREATE OR REPLACE STAGE SNOW_INVEST.BRONZE.EXTERNAL_DATA_STAGE
  URL='s3://yours3/'
  CREDENTIALS=(AWS_KEY_ID='your_aws_key_id' AWS_SECRET_KEY='your_aws_secret_key')
  ENCRYPTION=(TYPE='AWS_SSE_KMS' KMS_KEY_ID = 'your_kms_key_id');

CREATE OR REPLACE STAGE DOC_AI_DB.DOC_AI_SCHEMA.DUE_DILLIGENCE
  URL='s3://yours3/Due_dilligence'
  CREDENTIALS=(AWS_KEY_ID='your_aws_key_id' AWS_SECRET_KEY='your_aws_secret_key')
  ENCRYPTION=(TYPE='AWS_SSE_KMS' KMS_KEY_ID = 'your_kms_key_id');

CREATE WAREHOUSE IF NOT EXISTS DEMO_WH
  WITH WAREHOUSE_SIZE = 'MEDIUM'
  AUTO_SUSPEND = 60
  AUTO_RESUME = TRUE
  INITIALLY_SUSPENDED = TRUE;

USE ROLE securityadmin;

-- functional roles
CREATE OR REPLACE ROLE INVEST_ANALYST 
    COMMENT = 'Data Analyst Snow Invest';
    
-- role hierarchy
GRANT ROLE INVEST_ANALYST TO ROLE public;


-- privilege grants
GRANT USAGE ON DATABASE SNOW_INVEST TO ROLE INVEST_ANALYST;

GRANT USAGE ON ALL SCHEMAS IN DATABASE SNOW_INVEST TO ROLE INVEST_ANALYST;
GRANT ALL ON SCHEMA SNOW_INVEST.BRONZE TO ROLE INVEST_ANALYST;
GRANT ALL ON SCHEMA SNOW_INVEST.SILVER TO ROLE INVEST_ANALYST;
GRANT ALL ON SCHEMA SNOW_INVEST.GOLD TO ROLE INVEST_ANALYST;


GRANT ALL ON ALL TABLES IN SCHEMA SNOW_INVEST.BRONZE TO ROLE INVEST_ANALYST;
GRANT ALL ON ALL STAGES IN SCHEMA SNOW_INVEST.BRONZE TO ROLE INVEST_ANALYST;
GRANT ALL ON ALL TABLES IN SCHEMA SNOW_INVEST.SILVER TO ROLE INVEST_ANALYST;
GRANT ALL ON ALL TABLES IN SCHEMA SNOW_INVEST.GOLD TO ROLE INVEST_ANALYST;


GRANT ALL ON ALL VIEWS IN SCHEMA SNOW_INVEST.BRONZE TO ROLE INVEST_ANALYST;
GRANT ALL ON ALL VIEWS IN SCHEMA SNOW_INVEST.SILVER TO ROLE INVEST_ANALYST;
GRANT ALL ON ALL VIEWS  IN SCHEMA SNOW_INVEST.GOLD TO ROLE INVEST_ANALYST;


-- warehouse grants
GRANT ALL ON WAREHOUSE DEMO_WH TO ROLE INVEST_ANALYST;


-- future grants
GRANT ALL ON FUTURE TABLES IN SCHEMA SNOW_INVEST.BRONZE TO ROLE INVEST_ANALYST;
GRANT ALL ON FUTURE TABLES IN SCHEMA SNOW_INVEST.SILVER TO ROLE INVEST_ANALYST;
GRANT ALL ON FUTURE TABLES IN SCHEMA SNOW_INVEST.GOLD TO ROLE INVEST_ANALYST;


GRANT ALL ON FUTURE VIEWS IN SCHEMA SNOW_INVEST.BRONZE TO ROLE INVEST_ANALYST;
GRANT ALL ON FUTURE VIEWS IN SCHEMA SNOW_INVEST.SILVER TO ROLE INVEST_ANALYST;
GRANT ALL ON FUTURE VIEWS IN SCHEMA SNOW_INVEST.GOLD TO ROLE INVEST_ANALYST;

USE ROLE ACCOUNTADMIN;

-- Grant Snowflake Cortex LLM functions access
GRANT ROLE SNOWFLAKE.CORTEX_USER TO ROLE INVEST_ANALYST;

